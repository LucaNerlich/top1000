var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(v){var C=(e.of=function(t){return new e(t)},e.empty=function(){return new e(null)},e.prototype.get=function(){if(null===this.val)throw new Error("Trying to get() empty Option");return this.val},e.prototype.orElse=function(t){return null===this.val?t:this.val},e.prototype.orElseGet=function(t){return null===this.val?t():this.val},e.prototype.map=function(t){return null===this.val?e.empty():new e(t(this.val))},e.prototype.forEach=function(t){return null!==this.val&&t(this.val),this},e.prototype.toNull=function(){return null===this.val?null:this.val},e.prototype.isEmpty=function(){return null===this.val},e);function e(t){if((this.val=t)instanceof e)throw new Error("Trying to wrap Option into an Option");if(void 0===this.val)throw new Error("Option cannot contain undefined")}var n,w=(__extends(t,n=C),t.of=function(t){var e=typeof t;if(null!==t&&"number"!=e)throw new Error("Invalid score format, expected number, got "+e);return n.of.call(this,t)},t.empty=function(){return C.empty()},t);function t(){return null!==n&&n.apply(this,arguments)||this}var r,h=(__extends(i,r=C),i.of=function(t){var e=typeof t;if(null!==t&&"number"!=e)throw new Error("Invalid score format, expected number, got "+e);return r.of.call(this,t)},i.empty=function(){return C.empty()},i);function i(){return null!==r&&r.apply(this,arguments)||this}var E,o=function(t,e,n,r){if(this.first=t,this.second=e,this.winOrLose=n,this.userData=r,!t||!e)throw new Error("Cannot create ResultObject with undefined scores")};(u=E=E||{})[u.TBD=0]="TBD",u[u.BYE=1]="BYE",u[u.END=2]="END";var g=(s.first=function(){return new s(!0)},s.second=function(){return new s(!1)},s.prototype.map=function(t,e){return this.isFirst?t:e},s);function s(t){this.isFirst=t}var b=(Object.defineProperty(a.prototype,"name",{get:function(){return"function"==typeof this.nameOrGetter?this.nameOrGetter():this.nameOrGetter},set:function(t){this.nameOrGetter=t},enumerable:!0,configurable:!0}),a.prototype.emptyBranch=function(){if(!this.name.isEmpty())return this.sibling().name.isEmpty()?E.BYE:E.TBD;try{var t=this.source().emptyBranch();return t===E.TBD?E.TBD:t!==E.END&&this.source().sibling().emptyBranch()===E.TBD?E.TBD:E.BYE}catch(t){if(t instanceof c)return E.END;throw new Error('Unexpected exception type (message: "'+t.message+'")')}},a);function a(t,e,n,r,i){this.source=t,this.nameOrGetter=e,this.order=n,this.seed=r,this.score=i,this.sibling=function(){throw new Error("No sibling asigned")}}function k(t){return!isNaN(parseFloat(t))&&isFinite(t)}function c(){this.message="Root of information for this team",this.name="EndOfBranchException"}var T,u,l=(p.teamsInResultOrder=function(t){var e=t.a.name.isEmpty(),n=t.b.name.isEmpty(),r=t.winOrLose;if(!r.isEmpty())return 1==r.get()?[t.a,t.b]:[t.b,t.a];if(n&&!e)return t.b.emptyBranch()===E.BYE?[t.a,t.b]:[];if(e&&!n)return t.a.emptyBranch()===E.BYE?[t.b,t.a]:[];if(!t.a.score.isEmpty()&&!t.b.score.isEmpty()){if(t.a.score.get()>t.b.score.get())return[t.a,t.b];if(t.a.score.get()<t.b.score.get())return[t.b,t.a]}return[]},p.emptyTeam=function(t,e){t=new b(t,C.empty(),C.empty(),C.empty(),w.empty());return t.sibling=function(){return e},t},p.prototype.winner=function(){return p.teamsInResultOrder(this)[0]||p.emptyTeam(this.a.source,this.b)},p.prototype.loser=function(){return p.teamsInResultOrder(this)[1]||p.emptyTeam(this.b.source,this.a)},p);function p(t,e,n){this.a=t,this.b=e,this.winOrLose=n}function d(t){return function t(e,n){return e instanceof Array?t(e[0],n+1):n}(t,0)}function y(t,e,n){var r=n.find(".team[data-teamid="+t+"]"),i=e||"highlight";return{highlight:function(){r.each(function(){v(this).addClass(i),v(this).hasClass("win")&&v(this).parent().find(".connector").addClass(i)})},deHighlight:function(){r.each(function(){v(this).removeClass(i),v(this).parent().find(".connector").removeClass(i)})}}}function m(t,e,n){var r=v('<input type="text">');r.val(e),t.empty().append(r),r.focus(),r.blur(function(){n(r.val())}),r.keydown(function(t){var e=t.keyCode||t.which;9!==e&&13!==e&&27!==e||(t.preventDefault(),n(r.val(),27!==e))})}function f(t,e,n,r){switch(r){case T.EMPTY_BYE:return void t.append("BYE");case T.EMPTY_TBD:return void t.append("TBD");case T.ENTRY_NO_SCORE:case T.ENTRY_DEFAULT_WIN:case T.ENTRY_COMPLETE:return void t.append(e)}}function M(t){t=t.el;return t.find(".team.win").append('<div class="bubble">1st</div>'),t.find(".team.lose").append('<div class="bubble">2nd</div>'),!0}function O(t){t=t.el;return t.find(".team.win").append('<div class="bubble third">3rd</div>'),t.find(".team.lose").append('<div class="bubble fourth">4th</div>'),!0}function R(){throw new c}function x(n,t,e,r,i){for(var o,s,a,h,c,u=Math.log(2*t.length)/Math.log(2),l=t.length,p=0;p<u;p+=1){o=n.addRound(C.empty());for(var d=0;d<l;d+=1){var m,f=0===p?function(n,r){return function(){var t=new b(R,function(){return n[r][0]},C.of(g.first()),C.of(2*r),w.empty()),e=new b(R,function(){return n[r][1]},C.of(g.second()),C.of(2*r+1),w.empty());return t.sibling=function(){return e},e.sibling=function(){return t},[{source:function(){return t}},{source:function(){return e}}]}}(t,d):null;p===u-1&&e||p===u-1&&i?(m=o.addMatch(f,C.of(M)),i||m.setAlignCb(function(e,n){return function(t){t.css("top",""),t.css("position","absolute"),n?t.css("top",e.el.height()/2-t.height()/2+"px"):t.css("bottom",-t.height()/2+"px")}}(m,r.skipConsolationRound))):o.addMatch(f,C.empty())}l/=2}e&&(n.final().setConnectorCb(C.empty()),1<t.length&&!r.skipConsolationRound&&(s=n.final().getRound().prev(),a=s.map(function(t){return function(){return t.match(0).loser()}}).toNull(),h=s.map(function(t){return function(){return t.match(1).loser()}}).toNull(),(c=o.addMatch(function(){return[{source:a},{source:h}]},C.of(O))).setAlignCb(function(t){var e=n.el.height()/2;c.el.css("height",e+"px");e=t.height()/2+r.matchMargin;t.css("top",e+"px")}),c.setConnectorCb(C.empty())))}function N(i,o,s,a,t,h){var e,n,r=i.addRound(C.empty()),c=r.addMatch(function(){return[{source:function(){return o.winner()}},{source:function(){return s.winner()}}]},C.of(function(e){var n=!1;if(a.skipSecondaryFinal||e.winner().name.isEmpty()||e.winner().name!==s.winner().name){if(2===i.size())i.dropRound();else if(2<i.size())throw new Error("Unexpected number of final rounds");return M(e)}if(2===i.size())return!1;var r=i.addRound(C.of(function(){var t=!e.winner().name.isEmpty()&&e.winner().name===s.winner().name;return!1===n&&t&&(n=!0,h()),!t&&n&&(n=!1,i.dropRound(),h()),t})).addMatch(function(){return[{source:function(){return e.first()}},{source:function(){return e.second()}}]},C.of(M));return e.setConnectorCb(C.of(function(t){return{height:0,shift:t.height()/2}})),r.setConnectorCb(C.empty()),r.setAlignCb(function(t){var e=o.el.height()+s.el.height();r.el.css("height",e+"px");e=(o.el.height()/2+o.el.height()+s.el.height()/2)/2-t.height();t.css("top",e+"px")}),!1}));c.setAlignCb(function(t){var e=o.el.height()+s.el.height();a.skipConsolationRound||(e/=2),c.el.css("height",e+"px");e=(o.el.height()/2+o.el.height()+s.el.height()/2)/2-t.height();t.css("top",e+"px")}),a.skipConsolationRound||(e=s.final().getRound().prev(),(n=r.addMatch(function(){return[{source:function(){return e.get().match(0).loser()}},{source:function(){return s.loser()}}]},C.of(O))).setAlignCb(function(t){var e=(o.el.height()+s.el.height())/2;n.el.css("height",e+"px");e=(o.el.height()/2+o.el.height()+s.el.height()/2)/2+t.height()/2-e;t.css("top",e+"px")}),c.setConnectorCb(C.empty()),n.setConnectorCb(C.empty())),o.final().setConnectorCb(C.of(function(t){var e=t.height()/4,n=(o.el.height()/2+o.el.height()+s.el.height()/2)/2-t.height()/2-o.el.height()/2,r=o.winner().order.map(function(t){return t.map({height:n+2*e,shift:e*(a.centerConnectors?2:1)},{height:n+e*(a.centerConnectors?2:0),shift:e*(a.centerConnectors?2:3)})}).orElse({height:n+e*(a.centerConnectors?2:1),shift:2*e}),i=r.height,r=r.shift;return{height:i-t.height()/2,shift:r}})),s.final().setConnectorCb(C.of(function(t){var e=t.height()/4,n=(o.el.height()/2+o.el.height()+s.el.height()/2)/2-t.height()/2-o.el.height()/2,r=s.winner().order.map(function(t){return t.map({height:n+e*(a.centerConnectors?2:0),shift:e*(a.centerConnectors?2:3)},{height:n+2*e,shift:e*(a.centerConnectors?2:1)})}).orElse({height:n+e*(a.centerConnectors?2:1),shift:2*e}),i=r.height,r=r.shift;return{height:-(i+t.height()/2),shift:-r}}))}(u=T=T||{}).EMPTY_BYE="empty-bye",u.EMPTY_TBD="empty-tbd",u.ENTRY_NO_SCORE="entry-no-score",u.ENTRY_DEFAULT_WIN="entry-default-win",u.ENTRY_COMPLETE="entry-complete";var B=(Object.defineProperty(_.prototype,"el",{get:function(){return this.roundCon},enumerable:!0,configurable:!0}),_.prototype.addMatch=function(t,e){function n(){return o[0].source()}var r=this,i=this.matches.length,o=null!==t?t():[{source:function(){return r.bracket.round(r.roundNumber-1).match(2*i).winner()}},{source:function(){return r.bracket.round(r.roundNumber-1).match(2*i+1).winner()}}],t=function(){return o[1].source()},s=new b(n,n().name,C.of(g.first()),n().seed,w.empty()),a=new b(t,t().name,C.of(g.second()),t().seed,w.empty());s.sibling=function(){return a},a.sibling=function(){return s};t=new l(s,a,h.empty()),e=this.mkMatch(this,t,i,this.roundResults.map(function(t){return void 0===t[i]?null:t[i]}),e,this.isFirstBracket,this.opts);return this.matches.push(e),e},_.prototype.match=function(t){return this.matches[t]},_.prototype.prev=function(){return this.previousRound},_.prototype.size=function(){return this.matches.length},_.prototype.render=function(){this.roundCon.empty(),(this.doRenderCb.isEmpty()||this.doRenderCb.get()())&&(this.roundCon.appendTo(this.bracket.el),this.matches.forEach(function(t){return t.render()}))},_.prototype.results=function(){return this.matches.reduce(function(t,e){return t.concat([e.results()])},[])},_);function _(t,e,n,r,i,o,s,a){this.bracket=t,this.previousRound=e,this.roundNumber=n,this.roundResults=r,this.doRenderCb=i,this.mkMatch=o,this.isFirstBracket=s,this.opts=a,this.containerWidth=this.opts.teamWidth+this.opts.scoreWidth,this.roundCon=v('<div class="round" style="width: '+this.containerWidth+"px; margin-right: "+this.opts.roundMargin+'px"/>'),this.matches=[]}var D=(Object.defineProperty(F.prototype,"el",{get:function(){return this.bracketCon},enumerable:!0,configurable:!0}),F.prototype.addRound=function(t){var e=this.rounds.length,n=0<e?C.of(this.rounds[e-1]):C.empty(),r=this.initResults.map(function(t){return void 0===t[e]?new o(w.empty(),w.empty(),void 0,void 0):t[e]}),t=new B(this,n,e,r,t,this.mkMatch,this.isFirstBracket,this.opts);return this.rounds.push(t),t},F.prototype.dropRound=function(){this.rounds.pop()},F.prototype.round=function(t){return this.rounds[t]},F.prototype.size=function(){return this.rounds.length},F.prototype.final=function(){return this.rounds[this.rounds.length-1].match(0)},F.prototype.winner=function(){return this.rounds[this.rounds.length-1].match(0).winner()},F.prototype.loser=function(){return this.rounds[this.rounds.length-1].match(0).loser()},F.prototype.render=function(){this.bracketCon.empty();for(var t=0,e=this.rounds;t<e.length;t++)e[t].render()},F.prototype.results=function(){return this.rounds.reduce(function(t,e){return t.concat([e.results()])},[])},F);function F(t,e,n,r,i){this.bracketCon=t,this.initResults=e,this.mkMatch=n,this.isFirstBracket=r,this.opts=i,this.rounds=[]}function Y(t){t=v.extend(!0,{},t);return t.teams=t.teams.map(function(t){return t.map(function(t){return t.toNull()})}),t.results=t.results.map(function(t){return t.map(function(t){return t.map(function(t){var e=[t.first.toNull(),t.second.toNull()];return void 0!==t.userData&&e.push(t.userData),e})})}),t}var W=(P.prototype.get=function(){return this.counter},P.prototype.getNext=function(){return++this.counter},P.prototype.reset=function(){this.counter=0},P);function P(){this.counter=0}function A(o,t,s,e,n,r,a,i,h,c){var u=s.name.isEmpty()||e.name.isEmpty()?"":'data-resultid="result-'+i.getNext()+'"',l=v('<div class="score" style="width: '+a.scoreWidth+'px;" '+u+"></div>"),p=s.name.isEmpty()||e.name.isEmpty()||!n?C.empty():s.score.map(function(t){return""+t}),d=p.orElse("--");l.text(d);var m,f,g,b,y=v('<div class="team" style="width: '+(a.teamWidth+a.scoreWidth)+'px;"></div>'),u=v('<div class="label" style="width: '+a.teamWidth+'px;"></div>').appendTo(y);return a.decorator.render(u,s.name.toNull(),d,(f=e,g=p,(m=s).name.map(function(){return g.map(function(){return T.ENTRY_COMPLETE}).orElseGet(function(){return f.emptyBranch()===E.BYE?T.ENTRY_DEFAULT_WIN:T.ENTRY_NO_SCORE})}).orElseGet(function(){var t=m.emptyBranch();switch(t){case E.BYE:return T.EMPTY_BYE;case E.TBD:return T.EMPTY_TBD;default:throw new Error("Unexpected branch type "+t)}}))),s.seed.forEach(function(t){y.attr("data-teamid",t)}),s.name.isEmpty()?y.addClass("na"):t.winner().name===s.name?y.addClass("win"):t.loser().name===s.name&&y.addClass("lose"),y.append(l),(!s.name.isEmpty()||s.name.isEmpty()&&0===o&&r)&&"function"==typeof a.save&&(a.disableTeamEdit||(u.addClass("editable"),u.click(function(){var i=v(this);!function r(){i.unbind(),a.decorator.edit(i,s.name.toNull(),function(t,e){var n=s.seed.get();a.init.teams[~~(n/2)][n%2]=C.of(t||null),c(!0),i.click(r),(n=a.el.find(".team[data-teamid="+(n+1)+"] div.label:first")).length&&!0===e&&0===o&&v(n).click()})}()})),s.name.isEmpty()||e.name.isEmpty()||!n||(b=i.get(),l.addClass("editable"),l.click(function(){var r=v(this);!function e(){r.unbind();var t=k(s.score)?r.text():"0",n=v('<input type="text">');n.val(t),r.empty().append(n),n.focus().select(),n.keydown(function(t){k(v(this).val())?v(this).removeClass("error"):v(this).addClass("error");var e=t.keyCode||t.which;9!==e&&13!==e&&27!==e||(t.preventDefault(),v(this).blur(),27===e||(e=h.find("div.score[data-resultid=result-"+(b+1)+"]"))&&e.click())}),n.blur(function(){var t=n.val();t&&k(t)||k(s.score)?t&&k(t)||!k(s.score)||(t=s.score):t="0",r.html(t),k(t)&&(s.score=w.of(parseInt(t,10)),c(!0)),r.click(e)})}()}))),y}var G=(Object.defineProperty(L.prototype,"el",{get:function(){return this.matchCon},enumerable:!0,configurable:!0}),L.prototype.getRound=function(){return this.round},L.prototype.setConnectorCb=function(t){this.connectorCb=t},L.prototype.connect=function(t){var e,n,r,i=this,o="lr"===this.opts.dir?"right":"left",s=this.teamCon.height()/4,a=this.matchCon.height()/2,h=t.map(function(t){return t(i.teamCon,i)}).orElseGet(function(){return i.seed%2==0?i.winner().order.map(function(t){return t.map({height:a,shift:s*(i.opts.centerConnectors?2:1)},{height:a-s*(i.opts.centerConnectors?0:2),shift:s*(i.opts.centerConnectors?2:3)})}).orElse({height:a-s*(i.opts.centerConnectors?0:1),shift:2*s}):i.winner().order.map(function(t){return t.map({height:-a+s*(i.opts.centerConnectors?0:2),shift:-s*(i.opts.centerConnectors?2:3)},{height:-a,shift:-s*(i.opts.centerConnectors?2:1)})}).orElse({height:-a+s*(i.opts.centerConnectors?0:1),shift:2*-s})});this.teamCon.append((e=this.opts.roundMargin,n=h,r=this.teamCon,t=o,h=n.shift,o=(n=(o=n.height)<0?{height:-o,drop:!1}:o<2?{height:0,drop:!0}:{height:o,drop:!0}).height,n=n.drop,e/=2,(r=v('<div class="connector"></div>').appendTo(r)).css("height",o),r.css("width",e+"px"),r.css(t,-e-2+"px"),0<=h?r.css("top",h-1+"px"):r.css("bottom",-h-1+"px"),n?r.css("border-bottom","none"):r.css("border-top","none"),(h=v('<div class="connector"></div>').appendTo(r)).css("width",e+"px"),h.css(t,-e+"px"),n?h.css("bottom","0px"):h.css("top","0px"),r))},L.prototype.winner=function(){return this.match.winner()},L.prototype.loser=function(){return this.match.loser()},L.prototype.getWinOrLose=function(){return this.winOrLose},L.prototype.first=function(){return this.match.a},L.prototype.second=function(){return this.match.b},L.prototype.setAlignCb=function(t){this.alignCb=t},L.prototype.render=function(){var e=this;this.matchCon.empty(),this.teamCon.empty(),this.match.a.name=this.match.a.source().name,this.match.b.name=this.match.b.source().name,this.match.a.seed=this.match.a.source().seed,this.match.b.seed=this.match.b.source().seed,!(this.match.a.name.isEmpty()&&this.match.b.name.isEmpty())&&this.match.winner().name?this.teamCon.removeClass("np"):this.teamCon.addClass("np");var t=!this.match.a.name.isEmpty()&&!this.match.b.name.isEmpty();this.teamCon.append(A(this.round.roundNumber,this.match,this.match.a,this.match.b,t,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.teamCon.append(A(this.round.roundNumber,this.match,this.match.b,this.match.a,t,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll)),this.matchCon.appendTo(this.round.el),this.matchCon.append(this.teamCon),this.el.css("height",this.round.bracket.el.height()/this.round.size()+"px"),this.teamCon.css("top",this.el.height()/2-this.teamCon.height()/2+"px"),null!==this.alignCb&&this.alignCb(this.teamCon),this.renderCb.map(function(t){return t(e)}).orElse(!1)||this.connect(this.connectorCb)},L.prototype.results=function(){return(this.match.a.name.isEmpty()||this.match.b.name.isEmpty())&&(this.match.a.score=this.match.b.score=w.empty()),new o(this.match.a.score,this.match.b.score,this.winOrLose,this.matchUserData)},L);function L(t,e,n,r,i,o,s,a,h,c){var u;this.round=t,this.match=e,this.seed=n,this.renderCb=i,this.isFirstBracket=o,this.opts=s,this.resultId=a,this.topCon=h,this.renderAll=c,this.connectorCb=C.empty(),this.matchCon=v('<div class="match"></div>'),this.teamCon=v('<div class="teamContainer"></div>'),this.alignCb=null,this.matchUserData=r.isEmpty()?void 0:r.get().userData,this.winOrLose=r.isEmpty()?void 0:r.get().winOrLose,s.save||(u=this.matchUserData,s.onMatchHover&&this.teamCon.hover(function(){s.onMatchHover(u,!0)},function(){s.onMatchHover(u,!1)}),s.onMatchClick&&this.teamCon.click(function(){s.onMatchClick(u)})),e.a.name=e.a.source().name,e.b.name=e.b.source().name,e.a.score=r.map(function(t){return t.first.toNull()}),e.b.score=r.map(function(t){return t.second.toNull()}),e.winOrLose=r.map(function(t){return t.winOrLose.toNull()}),e.a.name&&e.b.name||!k(e.a.score)&&!k(e.b.score)||(console.warn("ERROR IN SCORE DATA: "+e.a.source().name+": "+e.a.score+", "+e.b.source().name+": "+e.b.score),e.a.score=e.b.score=w.empty())}function I(t){return void 0===t?null:t}var j=function(o){var i,s,n,r,t,e,a,h=new W,c=o.init,u=c.results.length<=1,l=45*c.teams.length+c.teams.length*o.matchMargin,p=v('<div class="jQBracket '+o.dir+'"></div>').appendTo(o.el.empty());function d(){var t,e,n,r,i,i=(t=c.teams.length,e=u,n=o.skipGrandFinalComeback,r=o.skipSecondaryFinal,i=c.results,e?Math.log(2*t)/Math.log(2):n?Math.max(2,2*(Math.log(2*t)/Math.log(2)-1)-1):(i=!r&&3===i.length&&2===i[2].length,2*(Math.log(2*t)/Math.log(2)-1)+1+(i?1:0)));o.disableToolbar?p.css("width",i*(o.teamWidth+o.scoreWidth+o.roundMargin)+10):p.css("width",i*(o.teamWidth+o.scoreWidth+o.roundMargin)+40),u&&c.teams.length<=2&&!o.skipConsolationRound&&p.css("height",l+40)}function m(t){var n,e,r;h.reset(),g.render(),i&&i.render(),s&&!o.skipGrandFinalComeback&&s.render(),o.disableHighlight||(n=p,e=g,e=(r=(r=s)||e).winner(),r=r.loser(),e&&r&&(e.name.isEmpty()||y(e.seed.get(),"highlightWinner",n).highlight(),r.name.isEmpty()||y(r.seed.get(),"highlightLoser",n).highlight()),n.find(".team").mouseover(function(){var t,e=v(this).attr("data-teamid");void 0!==e&&((t=y(parseInt(e,10),null,n)).highlight(),v(this).mouseout(function(){t.deHighlight(),v(this).unbind("mouseout")}))})),t&&(c.results[0]=g.results(),i&&(c.results[1]=i.results()),s&&!o.skipGrandFinalComeback&&(c.results[2]=s.results()),d(),o.save&&o.save(Y(c),o.userData))}o.skipSecondaryFinal&&u&&v.error("skipSecondaryFinal setting is viable only in double elimination mode"),o.disableToolbar||(f=p,n=c,r=o,f=v('<div class="tools"></div>').appendTo(f),v('<span class="increment">+</span>').appendTo(f).click(function(){for(var t=n.teams.length,e=0;e<t;e+=1)n.teams.push([C.empty(),C.empty()]);return j(r)}),(1<n.teams.length&&1===n.results.length||2<n.teams.length&&3===n.results.length)&&v('<span class="decrement">-</span>').appendTo(f).click(function(){if(1<n.teams.length)return n.teams=n.teams.slice(0,n.teams.length/2),j(r)}),1===n.results.length&&1<n.teams.length?v('<span class="doubleElimination">de</span>').appendTo(f).click(function(){if(1<n.teams.length&&n.results.length<3)return n.results.push([],[]),j(r)}):3===n.results.length&&1<n.teams.length&&v('<span class="singleElimination">se</span>').appendTo(f).click(function(){if(3===n.results.length)return n.results=n.results.slice(0,1),j(r)})),u?e=v('<div class="bracket"></div>').appendTo(p):(o.skipGrandFinalComeback||(t=v('<div class="finals"></div>').appendTo(p)),e=v('<div class="bracket"></div>').appendTo(p),a=v('<div class="loserBracket"></div>').appendTo(p)),e.css("height",l),a&&a.css("height",e.height()/2),d();var f=function(t,e,n,r,i,o,s){return new G(t,e,n,r,i,o,s,h,p,m)},g=new D(e,C.of(c.results[0]||null),f,!0,o);return u||(i=new D(a,C.of(c.results[1]||null),f,!1,o),o.skipGrandFinalComeback||(s=new D(t,C.of(c.results[2]||null),f,!1,o))),x(g,c.teams,u,o,o.skipGrandFinalComeback&&!u),u||(function(t,e,n,r,i){for(var o=Math.log(2*n)/Math.log(2)-1,s=n/2,a=0;a<o;a+=1){for(var h=r&&a===o-1?1:2,c=0;c<h;c+=1)for(var u=e.addRound(C.empty()),l=0;l<s;l+=1){var p=c%2!=0||0===a?function(e,n,r,i,o,s){return function(){if(o%2==0&&0===s)return[{source:function(){return e.round(0).match(2*i).loser()}},{source:function(){return e.round(0).match(2*i+1).loser()}}];var t=s%2==0?r-i-1:i;return[{source:function(){return n.round(2*s).match(i).winner()}},{source:function(){return e.round(s+1).match(t).loser()}}]}}(t,e,s,l,c,a):null,d=a===o-1&&r,p=u.addMatch(p,C.of(d?O:null));p.setAlignCb(function(t,e){return function(){return t.css("top",e.el.height()/2-t.height()/2+"px")}}(p.el.find(".teamContainer"),p)),d?p.setConnectorCb(C.empty()):(a<o-1||c<1)&&(d=c%2==0?function(i){return function(t,e){var n=t.height()/4,r={height:0,shift:2*n};return e.winner().order.map(function(t){return t.map(i?r:{height:0,shift:n},i?r:{height:2*-n,shift:n})}).orElse(r)}}(i):null,p.setConnectorCb(C.of(d)))}s/=2}}(g,i,c.teams.length,o.skipGrandFinalComeback,o.centerConnectors),o.skipGrandFinalComeback||N(s,g,i,o,0,d)),m(!1),{data:function(){return Y(o.init)}}};function H(t,e){if(t.hasOwnProperty(e)){t=typeof t[e];if("number"!=t)throw new Error('Option "'+e+'" is '+t+" instead of number")}}function S(t,e){var n="boolean";if((t=typeof t[e])!=n)throw new Error("Value of "+e+" must be boolean, got "+n+", got "+t)}function U(t,e,n){if((e=e[n])<t)throw new Error("Value of "+n+" must be greater than "+t+", got "+e)}var z={init:function(t){var e=v.extend(!0,{},t);if(!e)throw Error("Options not set");if(!e.init&&!e.save)throw Error("No bracket data or save callback given");if(void 0===e.userData&&(e.userData=null),!(!e.decorator||e.decorator.edit&&e.decorator.render))throw Error("Invalid decorator input");e.decorator||(e.decorator={edit:m,render:f}),e.init||(e.init={results:[],teams:[[C.empty(),C.empty()]]}),e.el=this,e.save&&(e.onMatchClick||e.onMatchHover)&&v.error("Match callbacks may not be passed in edit mode (in conjunction with save callback)");var n=typeof e.disableToolbar,t=e.hasOwnProperty("disableToolbar");t&&"boolean"!=n&&v.error("disableToolbar must be a boolean, got "+n),!e.save&&t&&v.error('disableToolbar can be used only if the bracket is editable, i.e. "save" callback given'),t||(e.disableToolbar=void 0===e.save);n=typeof e.disableTeamEdit,t=e.hasOwnProperty("disableTeamEdit");t&&"boolean"!=n&&v.error("disableTeamEdit must be a boolean, got "+n),!e.save&&t&&v.error('disableTeamEdit can be used only if the bracket is editable, i.e. "save" callback given'),t||(e.disableTeamEdit=!1),!e.disableToolbar&&e.disableTeamEdit&&v.error('disableTeamEdit requires also resizing to be disabled, initialize with "disableToolbar: true"');t=function t(e,n){return 0<n&&(e=t([e],n-1)),e}(e.init.results,4-d(e.init.results));e.init.results=t.map(function(t){return t.map(function(t){return t.map(function(t){return new o(w.of(I(t[0])),w.of(I(t[1])),h.of(I(t[2])),t[3])})})}),H(e,"teamWidth"),H(e,"scoreWidth"),H(e,"roundMargin"),H(e,"matchMargin"),e.hasOwnProperty("teamWidth")||(e.teamWidth=70),e.hasOwnProperty("scoreWidth")||(e.scoreWidth=30),e.hasOwnProperty("roundMargin")||(e.roundMargin=40),e.hasOwnProperty("matchMargin")||(e.matchMargin=20),U(0,e,"teamWidth"),U(0,e,"scoreWidth"),U(0,e,"roundMargin"),U(0,e,"matchMargin"),e.hasOwnProperty("centerConnectors")||(e.centerConnectors=!1),S(e,"centerConnectors"),e.hasOwnProperty("disableHighlight")||(e.disableHighlight=!1),S(e,"disableHighlight");t=(t=e.init.teams.length)&t-1;t!==Math.floor(t)&&v.error('"teams" property must have 2^n number of team pairs, i.e. 1, 2, 4, etc. Got '+e.init.teams.length+" team pairs."),e.dir=e.dir||"lr",e.init.teams=e.init.teams&&0!==e.init.teams.length?e.init.teams:[[null,null]],e.init.teams=e.init.teams.map(function(t){return t.map(function(t){return null===t?C.empty():C.of(t)})}),e.skipConsolationRound=e.skipConsolationRound||!1,e.skipSecondaryFinal=e.skipSecondaryFinal||!1,"lr"!==e.dir&&"rl"!==e.dir&&v.error('Direction must be either: "lr" or "rl"');e=j(e);return v(this).data("bracket",{target:this,obj:e}),e},data:function(){return v(this).data("bracket").obj.data()}};v.fn.bracket=function(t){return z[t]?z[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void v.error("Method "+t+" does not exist on jQuery.bracket"):z.init.apply(this,arguments)}}(jQuery);